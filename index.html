<!DOCTYPE html>
<html>

<head>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="apple-touch-icon" href="launch.png">
  <link rel="apple-touch-startup-image" href="launch.png">
  <meta name="apple-mobile-web-app-title" content="Push To Telescope">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

</head>

<body>

  <script>
    addEventListener('load', function(e) {

      cl = (arg) => console.log(arg)
      makeObject = (array, names) => {
        o = {}
        names.map((v, i) => o[v] = array[i])
        return o
      }
      r = Math.random()
      shuffle = (a, b) => Math.random(r) - 0.5

      //MODEL

      patternIndex = 0
      question = true
      substitutedWordIndex = 0
      englishSentenceText = " "
      maoriSentenceText = " "
      maoriAnswerText = "."
      gridWords = []
      sentenceCorrect = false

      patternsCSV = [
        // "what will the [animal] do,ka aha te [animal],the [animal] will [verb1],ka [verb1] te [animal]",
        // "what is the [animal] doing,kei te aha te [animal],the [animal] is [verb2],kei te [verb2] te [animal]",
        // "what has the [animal] done,kua aha te [animal],the [animal] has [verb3],kua [verb3] te [animal]",
        // "what did the [animal] do,i aha te [animal],the [animal] [verb4] -ed,i [verb4] te [animal]",
        // "what was the [animal] doing,i te aha [animal],the [animal] was [verb5] -ing,i te [verb5] te [animal]",
        //1
        "what is your name,ko wai tōu ingoa,my name is [name],ko [name] tōku ingoa",
        "where are you from?,nō hea koe,I am from [place],nō [place] ahau",
        "how are you feeling (KT form),kei te pehea koe,I am feeling [feeling1],kei te [feeling1] ahau",
        "how are you feeling (EA form),e pehea ana koe,I am feeling [feeling1],e [feeling1] ana ahau",

        "what is that,he aha tēnā,this is a [household],he [household] tēnei",
        "what is that over there,he aha tērā,this is a [house],he [house] tērā",
        "what is this thing by me,he aha tēnei,that thing by you is a [transport],he [transport] tēnā",

        "what are those,he aha ēnā,these are [household] -s,he [household] ēnei",
        "what are those over there,he aha ērā,these are [house] -s,he [house] ērā",
        "what are these things by me,he aha ēnei,those things by you are [transport] -s,he [transport] ēnā",
        //11
        "is that a [household] ?,he [household] tēnā ?,[affirmation],[affirmation]",

        "what type of [house] is this,he [house] aha tēnei,this is a [colour] [house],he [house] [colour] tēnā",

        "where is [name],kei hea a [name],[name] is [locative] the [house],kei [locative] a [name] i te [house]",
        "where is the [food],kei hea te [food],the [food] is [locative] the [transport],kei [locative] te [food] i te [transport]",
        "where is your [relation],kei hea tōu [relation],My [relation] is [locative] the [household],kei te [household] tōku [relation]",

        "how many [kitchen] are there,e hia ngā [kitchen],there are [cardinal] [kitchen],[cardinal] ngā [kitchen]",

        "who is/are your [relation],ko wai [relation],My [relation] is Mere,ko Mere (t)ōku [relation]",
        "what is/am/are [pronoun] doing,kei te aha [pronoun], [pronoun] is/am/are [verb1],kei te [verb1] [pronoun]",

        "how many [relation] do you have,tokohia āu [relation],I have rima [relation],tokohia rima (t)ōku [relation]",

        "what is the time,ko te aha te wa,the time is [time],ko te [time] te wa",
        "what day is it,ko te aha tēnei rā,the day is [day],ko te [day] tēnei rā",
        "what month is this,ko te aha tēnei marama,the month is [month],ko [month] tēnei marama",


        "the [animal] will [verb1],ka [verb1] te [animal],the [animal] is [verb1] -ing,kei te [verb1] te [animal]",
        "the [animal] has [verb2] -ed,kua [verb2] te [animal],the [animal] [verb2] -ed,i [verb2] te [animal]",
        "the [animal] was [verb3] -ing,i te [verb3] te [animal],the [animal] is still [verb3] -ing,e [verb3] ana te [animal]",

        //"the [animal] is [verb1] the [food],kei te [verb1] te [animal] i te [food],the [animal] is [verb1] the [food],kei te [verb1] te [animal] ki te [food]",
        "the [animal] will be [feeling1],ka [feeling1] te [animal],the [animal] is [feeling1],kei te [feeling1] te [animal]",
        "the [animal] has been [feeling2],kua [feeling2] te [animal],the [animal] was [feeling2],i [feeling2] te [animal]",

        "how much does a [food] cost,e hia te utu mō te [food],[cost] is the cost of the [food],[cost] te utu mō te [food]",
        "how much does a [animal] cost,e hia te utu mō te [animal],[cost] is the cost of the [animal],[cost] te utu mō te [animal] ",


      ]

      tupuCSV = [

        "name,Mary,Mere",
        "name,John,Hoani",
        "name,Peter,Pita",
        "name,Brian,Brian",

        "place,Dunedin,Onetāhi",
        "place,Auckland,Tamaki Makaurau",
        "place,One Tree Hill,Maungakiekie",
        "place,New Plymouth,Ngāmotu",
        "place,Christchurch,Ōtautahi",
        "place,Taupō,Taupō-nui-a-Tia",
        "place,Tauranga,Tauranga-moana",
        "place,Kaikoura,Te Ahi-kai-kōura-a-Tama-ki-te-rangi",
        "place,Hokianga,Te Hokianga-a-Kupe",
        "place,Wellington,Te Whanga-nui-a-Tara",
        "place,Nelson,Whakatū",
        "place,Gisborne,Tūranga-nui-a-Kiwa",

        "feeling1,happy,hari",
        "feeling1,bored,hōhā",
        "feeling1,sick,māuiui",
        "feeling1,furious,pukuriri",
        "feeling1,sleepy,hiamoe",
        "feeling1,surprised,ohorere",
        "feeling1,overjoyed,harikoa",
        "feeling1,confused,rangirua",
        "feeling1,hot,wera",
        "feeling1,cold,makariri",
        "feeling1,good,pai",
        "feeling1,tired,ngēngē",

        "feeling2,lost,ngaro",
        "feeling2,arrogant,whakahīhī",
        "feeling2,lazy,māngere",
        "feeling2,thirsty,hiainu",
        "feeling2,angry,riri",
        "feeling2,correct,tika",
        "feeling2,well,ora",
        "feeling2,worried,āwangawanga",
        "feeling3,sad,pōuri",
        "feeling3,bad,kino",
        "feeling3,scared,mataku",
        "feeling3,confused,kutekute",
        "feeling3,hungry,hiakai",
        "feeling3,sharp,koi",
        "feeling3,wrong,ku to he",
        "feeling3,annoyed,whakahohā",
        "feeling3,pleased,waingohia",

        "cardinal,one,kotahi",
        "cardinal,two,e rua",
        "cardinal,three,e toru",
        "cardinal,four,e wha",
        "cardinal,five,e rima",
        "cardinal,six,e ona",
        "cardinal,seven,e whitu",
        "cardinal,eight,e waru",
        "cardinal,nine,e iwa",


        "affirmation,yes,ae",
        "affirmation,no,kahore",


        "colour,white,mā",
        "colour,red,whero",
        "colour,orange,karaka",
        "colour,yellow,kōwhai",
        "colour,green,kākāriki",
        "colour,black,mangu",
        "colour,blue,kikorangi",
        "colour,purple,waiporoporo",
        "colour,brown,parauri",
        "colour,grey,kiwikiwi",

        "body,nose,ihu",
        "body,neck,kakī",
        "body,tongue,arero",
        "body,chin,kauae",
        "body,hair,māhunga",
        "body,heart,manawa",
        "body,teeth,niho",
        "body,chest,poho",
        "body,bellypuku,",
        "body,hand,ringa",
        "body,head,upoko",
        "body,leg,waewae",
        "body,breast,ū",
        "body,penis,ure",
        "body,vagina,tenetene",
        "body,knee,turi",

        "kitchen,frying pan,parai",
        "kitchen,knife,ripi",
        "kitchen,oven,ōmu",
        "kitchen,ladle,kōtutu",
        "kitchen,pot,kōhua",
        "kitchen,serviette,parehūhare",
        "kitchen,spoon,koko",
        "kitchen,tea towel,tītaora",
        "kitchen,tongs,pīnohi",
        "kitchen,serving platter,paepae mahora",
        "kitchen,plastic wrap,takai kirihou",
        "kitchen,hob,mura",


        "relation,father,matua",
        "relation,mother,whaea",

        "time,2:10,tekau mai i te rua",
        "time,3:30,haurua mai i te toru",
        "time,12:45,hauwha ki te tahi",
        "time,4:50,tekau ki te rima",
        "time,8:24,rua tekau mai i te waru",

        "day,monday,Rāhina",
        "day,tueday,Rātū",
        "day,wednesday,Rāapa",
        "day,Thursday,Rāpare",
        "day,Friday,Rāmere",
        "day,Saturday,Rāhoroi",
        "day,Sunday,Rātapu",

        "month,January,Kohitātea",
        "month,February,Hui-tanguru",
        "month,March,Poutū-te-rangi",
        "month,April,Paenga-whāwhā",
        "month,May,Haratua",
        "month,June,Pipiri",
        "month,July,Hōngongoi",
        "month,August,Here-turi-kōkā",
        "month,September,Mahuru",
        "month,October,Whiringa-ā-nuku",
        "month,November,Whiringa-ā-rangi",
        "month,December,Hakihea",

        "locative,under,raro",
        "locative,on,runga",
        "locative,outside,waho",
        "locative,inside,roto",
        "locative,behind,muri",
        "locative,in front,mua",
        "locative,between,waenganui",
        "locative,here by me,konei",
        "locative,there by you,konā",
        "locative,over there by them,kora",
        "locative,overseas,tāwāhi",
        "locative,right side,taha matau",
        "locative,left side,taha mauī",


        "pronoun,I/me,ahau",
        "pronoun,you,koe",
        "pronoun,him/her,ia",
        "pronoun,us (2),tāua",
        "pronoun,us (3+),tātou",
        "pronoun,we (2 but not you),māua",
        "pronoun,we (3+ but not you),mātou",
        "pronoun,you (2),kōrua",
        "pronoun,you (3+),koutou",
        "pronoun,them (2),rāua",
        "pronoun,them (3+),rātou",

        "possessive,my,(t)ōku",
        "possessive,your(s),(t)ōu",
        "possessive,their(s),(t)ōna",

        "verb1,eating,kai",
        "verb1,singing,waiata",
        "verb1,sleeping,moe",
        "verb1,walking,hīkoi",
        "verb1,drink,inu",
        "verb1,nourish,whāngai",
        "verb1,run,oma",
        "verb1,come,haere",
        "verb1,cry,tangi",
        "verb1,work,mahi",
        "verb1,talk,kōrero",
        "verb1,snore,ngōngoro",

        "verb2,read,pānui",
        "verb2,shout,ūmere",
        "verb2,stand,tū",
        "verb2,carry,hari",
        "verb2,come,kuhu",
        "verb2,come down,heke",
        "verb2,cook,tunu",
        "verb2,gather,tiki",
        "verb2,buy,utu",
        "verb2,learn,ako",

        "verb3,return,hoki",
        "verb3,pray,inoi",
        "verb3,understand,mārama",
        "verb3,remember,māharahara",
        "verb3,cut,tapahi",
        "verb3,dance,kanikani",
        "verb3,look,titro",
        "verb3,watch,mātakitaki",
        "verb3,see,kite",
        "verb3,greet,mihi",
        "verb3,call,karanga",

        "verb4,write,tuhi",
        "verb4,argue,whawhai",
        "verb4,listen,whakarongo",
        "verb4,laugh,katakata",
        "verb4,sit,noho",
        "verb4,purchase,hoko",
        "verb4,exit,puta",
        "verb4,climb,piki",
        "verb4,take off,tango",
        "verb4,wait,taihoa",
        "verb4,smile,menemene",
        "verb4,embrace,awhiawhi",

        "verb5,kiss,kihi",
        "verb5,answer,whakautu",
        "verb5,teach,akona",
        "verb5,give back,homai",
        "verb5,question,patai",
        "verb5,know,mōhio",
        "verb5,send,tono",

        "command1,stand up,e tū",
        "command1,sit down,e noho",

        "tense,am/are,kei te",
        "tense,will,ka",
        "tense,has just,kua",
        "tense,had,i",
        "tense,was,i te",

        "people,child,tamaiti",
        "people,man,tane",
        "people,woman,wahine",
        "people,teacher,kaiako",
        "people,student,tauira",

        "animal,dog,kurī",
        "animal,sheep,hipi",
        "animal,chicken,heihei",
        "animal,duck,rakiraki",
        "animal,pig,poaka",
        "animal,cat,ngeru",
        "animal,cow,kau",
        "animal,horse,hōiho",
        "animal,goat,nanekoti",

        "transport,canoe,waka",
        "transport,bus,pahi",
        "transport,train,tereina",
        "transport,helicopter,wakatopatopa",
        "transport,truck,taraka",
        "transport,bicycle,paihikara",
        "transport,car,motoka",

        "food,egg,hēki",
        "food,pen,pene",
        "food,seafood,kaimoana",
        "food,vegetables,hua whenua",
        "food,fruit,hua rākau",
        "food,butter,pata",
        "food,cream,kirīmi",
        "food,apple,āporo",
        "food,milk,miraka",
        "food,bread loaf,paraoa",
        "food,banana,panana",
        "food,lolly,rare",

        "clothing,T-shirt,ti hate",

        "house,kitchen,kīhini",
        "house,lounge,rūma noho",
        "house,bedroom,rūma moe",
        "house,bathroom,rūma horoi tinana",
        "house,shed,wharau",
        "house,floor,papa",
        "house,ceiling,tuanui",
        "house,wall,pakitara",
        "house,window,matapihi",
        "house,door,kuaha",

        "household,broom,paruma",
        "household,chair,tūru",
        "household,table,tēpu",
        "household,lamp,rama",
        "household,phone,waea kōrero",
        "household,bed,moenga",
        "household,TV,pouaka whakaata",
        "household,freezer,pouaka tio",
        "household,fridge,poaka makariri",
        "household,bathtub,tāpu",
        "household,shower,uwhi",
        "household,cup,kapu",
        "household,drawer,toroa",
        "household,washing machine,mīhini horoi kakahu",

        "cost,$3.25,toru tāra e rua tekau mā rima hēneti",
        "cost,$1.73,kotahi tāra e whitu tekau mā toru hēneti",
        "cost,$38.69,e toru tekau mā waru tāra e ona tekau mā iwa hēneti",
        "cost,$403.52,e wha rau e toru tāra e rima tekau mā rua hēneti"

      ]

      patterns = []
      patternsCSV.forEach(v => patterns.push(makeObject(v.split(","), ["englishQ", "maoriQ", "englishA", "maoriA"])))

      tupus = []
      tupuCSV.forEach(v => tupus.push(makeObject(v.split(","), ["topic", "english", "maori"])))
      tupus.sort(shuffle)


      substituteEnglishVariableWord = (str) => {
        variableWord = str.match(/\[(\w+)\]/g)
        s = str
        if (variableWord != null) {
          variableWord.forEach((item) => {
            item = item.replace("[", "").replace("]", "")
            variableWords = tupus.filter(v => (v.topic == item))
            s = s.replace("[" + item + "]", variableWords[substitutedWordIndex % variableWords.length].english)
          })
        }
        return s
      }

      substituteMaoriVariableWord = (str) => {
        variableWord = str.match(/\[(\w+)\]/g)
        s = str
        if (variableWord != null) {
          variableWord.forEach((item) => {
            item = item.replace("[", "").replace("]", "")
            variableWords = tupus.filter(v => (v.topic == item))
            s = s.replace("[" + item + "]", variableWords[substitutedWordIndex % variableWords.length].maori)
          })
        }
        return s
      }

      //  substitutedWordIndex = (substitutedWordIndex == tupus.filter(v => v.topic == variableWord[1]).length) ? 0 : substitutedWordIndex++


      makeSentences = (patternIndex, question) => {
        if (question) {
          englishSentenceText = substituteEnglishVariableWord(patterns[patternIndex].englishQ)
          maoriSentenceText = substituteMaoriVariableWord(patterns[patternIndex].maoriQ)
        } else {
          englishSentenceText = substituteEnglishVariableWord(patterns[patternIndex].englishA)
          maoriSentenceText = substituteMaoriVariableWord(patterns[patternIndex].maoriA)
        }
      }

      maoriWordList = () => {
        list = []
        patterns.forEach(v => list = [...list, ...v.maoriQ.replace(/ \[(\w+)\]/, "").split(" ")])
        return list
      }

      topicWordList = () => {
        list = []
        str = question ? patterns[patternIndex].englishQ : patterns[patternIndex].englishA
        variableWord = str.match(/\[(\w+)\]/)
        if (variableWord != null) {
          tupus.filter(v => v.topic == variableWord[1]).forEach(v => list = [...list, ...v.maori.split(" ")])
        }
        return list
      }

      makeGridWords = () => {
        words = maoriSentenceText.replace(/\[(\w+)\]/, "").split(" ")
        words = [...words, ...maoriWordList(), ...topicWordList()] //, ...["tōku", "rāua", "ki", "ō", "aha", "koutou", "ona", "tōu", "haere", "māua", "i", "etahi"]]
        words = [...new Set(words)]
        words = words.slice(0, 24)
        words = words.sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()))
        gridWords = words
      }

      updateModel = () => {
        makeSentences(patternIndex, question)
        makeGridWords()
      }

      //VIEW

      addElement = (id, elementType, container, width, style, text) => {
        element = document.createElement(elementType)
        element.style.cssText = style
        element.style.width = width + "%"
        element.id = id
        element.innerHTML = text
        container.appendChild(element)
        return element
      }

      buttonStyle = "position:relative;color:black;background:ivory;border-style:solid;border-width:1px;font-size:3vw;font-family:verdana;"
      buttonLeftStyle = buttonStyle + "position:relative;float:left;"
      buttonRightStyle = buttonStyle + "position:relative;right:0;"
      divStyle = "position:relative;display:block;background:lavender;border-style:none;border-width:1px;font-size:3vw;font-family:verdana;"

      //sentenceStyle = "color:black;background-color:ivory;border-style:solid;border-width:1px;font-size:3vw;font-family:verdana;"
      correctButtonStyle = "color:limeGreen;background-color:ivory;border-style:solid;border-width:1px;font-size:3vw;font-family:verdana;"

      display = () => {
        updateModel()
        //cl(maoriAnswerText)
        //console.log(substitutedWordIndex)
        document.body.innerHTML = ""
        b = addElement(1, "div", document.body, 100, "", "")
        b.addEventListener("click", clicked)

        englishDiv = addElement("englishDiv", "div", b, 100, divStyle, "")
        redoButton = addElement("redoButton", "button", englishDiv, 7, buttonLeftStyle, "&#x1F504;")
        englishSentence = addElement("englishSentence", "button", englishDiv, 79, buttonStyle, patternIndex + 1 + ". " + englishSentenceText)
        nextPatternButton = addElement("nextPatternButton", "button", englishDiv, 7, buttonRightStyle, "&#x25B6;")
        next5PatternButton = addElement("nextPattern5Button", "button", englishDiv, 7, buttonRightStyle, "&#x23E9;")

        maoriDiv = addElement("maoriDiv", "div", b, 100, divStyle, "")
        maoriSentenceElement = addElement("maoriSentence", "button", maoriDiv, 85, sentenceCorrect ? correctButtonStyle : buttonStyle, maoriAnswerText)
        deleteButton = addElement("deleteButton", "button", maoriDiv, 15, buttonRightStyle, "&#x232B;")

        wordGrid = addElement("wordGrid", "div", b, 100, divStyle, "")
        gridWords.forEach((v, i) => addElement("tupu" + i, "button", wordGrid, 33.33, buttonStyle, v))
      }

      displayWordlist = (str) => {
        document.body.innerHTML = ""
        b = addElement(1, "div", document.body, 100, "", "")
        b.addEventListener("click", clicked)
        wordlistDiv = addElement("wordlistDiv", "div", b, 100, divStyle, str)
        closeButton = addElement("closeButton", "button", wordlistDiv, 15, buttonRightStyle, "close")
      }

      //CONTROLLER

      clicked = e => {
        id = e.target.id
        if (id == "nextPatternButton") {
          question = !question
          if (question) {
            patternIndex = (patternIndex == patterns.length - 1) ? 0 : patternIndex + 1
            substitutedWordIndex++
          }
          maoriAnswerText = "."
          sentenceCorrect = false
          display()
        }

        if (id == "nextPattern5Button") {
          question = true

          patternIndex = (patternIndex + 5) % patterns.length
          console.log("patternIndex" + patternIndex + " patterns.length " + patterns.length)

          maoriAnswerText = "."
          sentenceCorrect = false
          display()
        }

        if (id == "englishSentence") {
          variableWord = patterns[patternIndex].englishA.match(/\[(\w+)\]/g)
          str = "<table><tbody>"
          if (variableWord != null) {
            variableWord.forEach((item) => {
              item = item.replace("[", "").replace("]", "")
              variableWords = tupus.filter(v => (v.topic == item))
              list = tupus.filter(v => (v.topic == item))
              list.forEach(v => str = str + "<tr><td>" + v.english + "</td><td>" + v.maori + "</td></tr>")
            })
            displayWordlist(str + "</tbody></table>" + "<br><br>")
          }
        }

        if (id == "closeButton") {
          console.log("clicked")
          display()
        }

        if (id == "maoriSentence") {
          displayWordlist(maoriSentenceText + "<br><br>")
        }

        if (id.includes("tupu")) {
          maoriAnswerText = maoriAnswerText + " " + gridWords[id.match(/\d+/g)]
          maoriAnswerText = maoriAnswerText.replace(".", "")
          if (maoriAnswerText.trim() == substituteMaoriVariableWord(patterns[patternIndex].maoriQ) ||
            maoriAnswerText.trim() == substituteMaoriVariableWord(patterns[patternIndex].maoriA))
            sentenceCorrect = true
          display()
        }

        if (id == "deleteButton") {
          maoriAnswerText = maoriAnswerText.substring(0, maoriAnswerText.lastIndexOf(" "))
          sentenceCorrect = false
          display()
        }

        if (id == "redoButton") {
          maoriAnswerText = "."
          substitutedWordIndex++
          sentenceCorrect = false
          display()
        }

      }

      display()
    })
  </script>
</body>

</html>
