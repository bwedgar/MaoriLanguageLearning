<!DOCTYPE html>
<html>

<head>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="apple-touch-icon" href="launch.png">
  <link rel="apple-touch-startup-image" href="launch.png">
  <meta name="apple-mobile-web-app-title" content="Push To Telescope">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

</head>

<body>

  <script>
    addEventListener('load', function(e) {

      cl = (arg) => console.log(arg)
      makeObject = (array, names) => {
        o = {}
        names.map((v, i) => o[v] = array[i])
        return o
      }
      r = Math.random()
      shuffle = (a, b) => Math.random(r) - 0.5

      //MODEL

      patternIndex = 0
      question = true
      substitutedWordIndex = 0
      englishSentenceText = " "
      maoriSentenceText = " "
      maoriAnswerText = "."
      gridWords = []
      sentenceCorrect = false

      patternsCSV = [
        // "what will the [noun1] do,ka aha te [noun1],the [noun1] will [verb1],ka [verb1] te [noun1]",
        // "what is the [noun1] doing,kei te aha te [noun1],the [noun1] is [verb2],kei te [verb2] te [noun1]",
        // "what has the [noun1] done,kua aha te [noun1],the [noun1] has [verb3],kua [verb3] te [noun1]",
        // "what did the [noun1] do,i aha te [noun1],the [noun1] [verb4] -ed,i [verb4] te [noun1]",
        // "what was the [noun1] doing,i te aha [noun1],the [noun1] was [verb5] -ing,i te [verb5] te [noun1]",

"how much does [noun2] cost,e hia te utu mō te [noun2],3 dollars and 20 cents is the cost of the [noun2],e toru tāra e rua tehau hēneti te utu mō te [noun2]",
"how much does [noun1] cost,e hia te utu mō te [noun1] ,33 dollars and 15 cents is the cost of the [noun1] ,e toru tāra e rua tehau hēneti te utu mō te [noun1] ",

  "the [noun1] will [verb1],ka [verb1] te [noun1],the [noun1] is [verb1] -ing,kei te [verb1] te [noun1]",
        "the [noun1] has [verb2] -ed,kua [verb2] te [noun1],the [noun1] [verb2] -ed,i [verb2] te [noun1]",
        "the [noun1] was [verb3] -ing,i te [verb3] te [noun1],the [noun1] is still [verb3] -ing,e [verb3] ana te [noun1]",
//"the [noun1] is [verb1] the [noun2],kei te [verb1] te [noun1] i te [noun2],the [noun1] is [verb1] the [noun2],kei te [verb1] te [noun1] ki te [noun2]",
        "the [noun1] will be [feeling1],ka [feeling1] te [noun1],the [noun1] is [feeling1],kei te [feeling1] te [noun1]",
        "the [noun1] has been [feeling2],kua [feeling2] te [noun1],the [noun1] was [feeling2],i [feeling2] te [noun1]",
        "what is the time,ko te aha te wa,the time is [time],ko te [time] te wa",
        "what day is it,ko te aha tēnei rā,the day is [day],ko te [day] tēnei rā",
        "what month is this,ko te aha tēnei marama,the month is [month],ko [month] tēnei marama",
        "how many [relation] do you have,tokohia āu [relation],I have rima [relation],tokohia rima (t)ōku [relation]",
        "how are you feeling?,kei te pehea koe,I am feeling [feeling],kei te [feeling] ahau",
        "where are you from?,nō hea koe,I am from [place],nō [place] ahau",
        "where is Mere,kei hea a Mere,Mere is [locative] the house,kei [locative] a Mere i te whare",
        "who is/are your [relation],ko wai [relation],My [relation] is Mere,ko Mere (t)ōku [relation]",
        "what is/am/are [pronoun] doing,kei te aha [pronoun], [pronoun] is/am/are [verb],kei te [verb] [pronoun]"

      ]

      tupuCSV = [
        "place,Dunedin,Onetāhi",
        "place,Auckland,Tamaki Makaurau",
        "place,One Tree Hill,Maungakiekie",
        "place,New Plymouth,Ngāmotu",
        "place,Christchurch,Ōtautahi",
        "place,Taupō,aupō-nui-a Tia",
        "place,Tauranga,Tauranga-moana",
        "place,Kaikoura,Te Ahi-kai-kōura-a-Tama-ki-te-rangi",
        "place,Hokianga,Te Hokianga-a-Kupe",
        "place,Wellington,Te Whanga-nui-a-Tara",
        "place,Nelson,Whakatū",
        "place,Gisborne,Tūranga-nui-a-Kiwa",

        "feeling1,happy,hari",
        "feeling1,bored,hōhā",
        "feeling1,sick,māuiui",
        "feeling1,furious,pukuriri",
        "feeling1,sleepy,hiamoe",
        "feeling1,surprised,ohorere",
        "feeling1,overjoyed,harikoa",
        "feeling1,confused,rangirua",
        "feeling1,hot,wera",
        "feeling1,cold,makariri",
        "feeling2,good,pai",
        "feeling2,tired,ngēngē",
        "feeling2,lost,ngaro",
        "feeling2,arrogant,whakahīhī",
        "feeling2,lazy,māngere",
        "feeling2,thirsty,hiainu",
        "feeling2,angry,riri",
        "feeling2,correct,tika",
        "feeling2,well,ora",
        "feeling2,worried,āwangawanga",
        "feeling3,sad,pōuri",
        "feeling3,bad,kino",
        "feeling3,scared,mataku",
        "feeling3,confused,kutekute",
        "feeling3,hungry,hiakai",
        "feeling3,sharp,koi",
        "feeling3,wrong,ku to he",
        "feeling3,annoyed,whakahohā",
        "feeling3,pleased,waingohia",

        "cardinal,one,kotahi",
        "cardinal,two,rua",
        "cardinal,three,toru",
        "relation,father,matua",
        "relation,mother,whaea",
        "time,2:10,tekau mai i te rua",
        "time,3:30,haurua mai i te toru",
        "time,12:45,hauwha ki te tahi",
        "time,4:50,tekau ki te rima",
        "time,8:24,rua tekau mai i te waru",
        "day,monday,Rāhina",
        "day,tueday,Rātū",
        "day,wednesday,Rāapa",
        "day,Thursday,Rāpare",
        "day,Friday,Rāmere",
        "day,Saturday,Rāhoroi",
        "day,Sunday,Rātapu",
        "month,January,Kohitātea",
        "month,February,Hui-tanguru",
        "month,March,Poutū-te-rangi",
        "month,April,Paenga-whāwhā",
        "month,May,Haratua",
        "month,June,Pipiri",
        "month,July,Hōngongoi",
        "month,August,Here-turi-kōkā",
        "month,September,Mahuru",
        "month,October,Whiringa-ā-nuku",
        "month,November,Whiringa-ā-rangi",
        "month,December,Hakihea",
        "locative,under,raro",
        "locative,on,runga",
        "locative,outside,waho",
        "locative,inside,roto",
        "locative,behind,muri",
        "locative,in front,mua",
        "locative,waenganui,between",
        "locative,konei,by me",
        "locative,konā,by you",
        "locative,kora,by them",
        "locative,overseas,tāwāhi",
        "pronoun,I/me,ahau",
        "pronoun,you,koe",
        "pronoun,him/her,ia",
        "pronoun,we (2 including you),tāua",
        "pronoun,we (3+ including you),tātou",
        "pronoun,we (2 but not you),māua",
        "pronoun,we (3+ but not you),mātou",
        "pronoun,you (2),kōrua",
        "pronoun,you (3+),koutou",
        "pronoun,they (2),rāua",
        "pronoun,they (3+),rātou",
        "verb1,eating,kai",
        "verb1,singing,waiata",
        "verb1,sleeping,moe",
        "verb1,walking,hīkoi",
        "verb1,drink,inu",
        "verb1,nourish,whāngai",
        "verb1,run,oma",
        "verb1,come,haere",
        "verb1,cry,tangi",
        "verb1,work,mahi",
        "verb1,talk,kōrero",
        "verb1,snore,ngōngoro",
        "verb2,read,pānui",
        "verb2,shout,ūmere",
        "verb2,stand,tū",
        "verb2,carry,hari",
        "verb2,come,kuhu",
        "verb2,come down,heke",
        "verb2,cook,tunu",
        "verb2,gather,tiki",
        "verb2,buy,utu",
        "verb2,learn,ako",
        "verb3,return,hoki",
        "verb3,pray,inoi",
        "verb3,understand,mārama",
        "verb3,māharahara",
        "verb3,cut,tapahi",
        "verb3,dance,kanikani",
        "verb3,look,titro",
        "verb3,see,kite",
        "verb3,greet,mihi",
        "verb3,call,karanga",
        "verb4,write,tuhi",
        "verb4,argue,tautohetohe",
        "verb4,listen,whakarongo",
        "verb4,laugh,katakata",
        "verb4,sit,noho",
        "verb4,purchase,hoko",
        "verb4,exit,puta",
        "verb4,climb,piki",
        "verb4,take off,tango",
        "verb4,wait,taihoa",
        "verb5,kiss,kihi",
        "verb5,answer,whakautu",
        "verb5,teach,akona",
        "verb5,give back,homai",
        "verb5,question,patai",
        "verb5,know,mōhio",
        "verb5,send,tono",




        "tense,am/are,kei te",
        "tense,will,ka",
        "tense,has just,kua",
        "tense,had,i",
        "tense,was,i te",
        "noun1,dog,kurī",
        "noun1,sheep,hipi",
        "noun1,man,tane",
        "noun1,woman,wahine",
        "noun1,teacher,kaiako",
        "noun1,student,tauira",
        "noun1,chicken,heihei",
        "noun2,egg,hēki",
        "noun2,pen,pene",
        "noun2,car,motoka",
        "noun2,apple,āporo",
        "noun2,milk,miraka",
        "noun2, bread,paraoa",
        "noun2,banana,panana",
        "noun2,lolly,rare",
        "noun2,T-shirt,Ti hate"





      ]

      patterns = []
      patternsCSV.forEach(v => patterns.push(makeObject(v.split(","), ["englishQ", "maoriQ", "englishA", "maoriA"])))

      tupus = []
      tupuCSV.forEach(v => tupus.push(makeObject(v.split(","), ["topic", "english", "maori"])))
      tupus.sort(shuffle)


      substituteEnglishVariableWord = (str) => {
        variableWord = str.match(/\[(\w+)\]/g)
        s = str
        if (variableWord != null) {
          variableWord.forEach((item) => {
            item = item.replace("[", "").replace("]", "")
            variableWords = tupus.filter(v => (v.topic == item))
            s = s.replace("[" + item + "]", variableWords[substitutedWordIndex].english)
          })
        }
        return s
      }

      substituteMaoriVariableWord = (str) => {
        variableWord = str.match(/\[(\w+)\]/g)
        s = str
        if (variableWord != null) {
          variableWord.forEach((item) => {
            item = item.replace("[", "").replace("]", "")
            variableWords = tupus.filter(v => (v.topic == item))
            s = s.replace("[" + item + "]", variableWords[substitutedWordIndex].maori)
          })
        }
        return s
      }

      //  substitutedWordIndex = (substitutedWordIndex == tupus.filter(v => v.topic == variableWord[1]).length) ? 0 : substitutedWordIndex++


      makeSentences = (patternIndex, question) => {
        if (question) {
          englishSentenceText = substituteEnglishVariableWord(patterns[patternIndex].englishQ)
          maoriSentenceText = substituteMaoriVariableWord(patterns[patternIndex].maoriQ)
        } else {
          englishSentenceText = substituteEnglishVariableWord(patterns[patternIndex].englishA)
          maoriSentenceText = substituteMaoriVariableWord(patterns[patternIndex].maoriA)
        }
      }

      maoriWordList = () => {
        list = []
        patterns.forEach(v => list = [...list, ...v.maoriQ.replace(/ \[(\w+)\]/, "").split(" ")])
        return list
      }

      topicWordList = () => {
        list = []
        str = question ? patterns[patternIndex].englishQ : patterns[patternIndex].englishA
        variableWord = str.match(/\[(\w+)\]/)
        if (variableWord != null) {
          tupus.filter(v => v.topic == variableWord[1]).forEach(v => list = [...list, ...v.maori.split(" ")])
        }
        return list
      }

      makeGridWords = () => {
        words = maoriSentenceText.replace(/\[(\w+)\]/, "").split(" ")
        words = [...words, ...maoriWordList(), ...topicWordList()] //, ...["tōku", "rāua", "ki", "ō", "aha", "koutou", "ona", "tōu", "haere", "māua", "i", "etahi"]]
        words = [...new Set(words)]
        words = words.slice(0, 24)
        words = words.sort((a, b) => a.toLowerCase().localeCompare(b.toLowerCase()))
        gridWords = words
      }

      updateModel = () => {
        makeSentences(patternIndex, question)
        makeGridWords()
      }

      //VIEW

      addElement = (id, elementType, container, width, style, text) => {
        element = document.createElement(elementType)
        element.style.cssText = style
        element.style.width = width + "%"
        element.id = id
        element.innerHTML = text
        container.appendChild(element)
        return element
      }

      buttonStyle = "position:relative;color:black;background:ivory;border-style:solid;border-width:1px;font-size:3vw;font-family:verdana;"
      buttonLeftStyle = buttonStyle + "position:relative;float:left;"
      buttonRightStyle = buttonStyle + "position:relative;right:0;"
      divStyle = "position:relative;display:block;border-style:none;border-width:1px;font-size:3vw;font-family:verdana;"

      //sentenceStyle = "color:black;background-color:ivory;border-style:solid;border-width:1px;font-size:3vw;font-family:verdana;"
      correctButtonStyle = "color:limeGreen;background-color:ivory;border-style:solid;border-width:1px;font-size:3vw;font-family:verdana;"

      display = () => {
        updateModel()
        cl(maoriAnswerText)
        document.body.innerHTML = ""
        b = addElement(1, "div", document.body, 100, "", "")
        b.addEventListener("click", clicked)

        englishDiv = addElement("englishDiv", "div", b, 100, divStyle, "")
        redoButton = addElement("redoButton", "button", englishDiv, 15, buttonLeftStyle, "@")
        englishSentence = addElement("englishSentence", "button", englishDiv, 70, buttonStyle, patternIndex+". "+englishSentenceText)
        nextPatternButton = addElement("nextPatternButton", "button", englishDiv, 15, buttonRightStyle, ">")

        maoriDiv = addElement("maoriDiv", "div", b, 100, divStyle, "")
        maoriSentenceElement = addElement("maoriSentence", "button", maoriDiv, 85, sentenceCorrect ? correctButtonStyle : buttonStyle, maoriAnswerText)
        deleteButton = addElement("deleteButton", "button", maoriDiv, 15, buttonRightStyle, "del")

        wordGrid = addElement("wordGrid", "div", b, 100, divStyle, "")
        gridWords.forEach((v, i) => addElement("tupu" + i, "button", wordGrid, 33.33, buttonStyle, v))
      }

      //CONTROLLER

      clicked = e => {
        id = e.target.id

        if (id == "nextPatternButton") {
          question = !question
          if (question) {
            patternIndex = (patternIndex == patterns.length - 1) ? 0 : patternIndex + 1
          }
          substitutedWordIndex = 0
          maoriAnswerText = "."
          sentenceCorrect = false
        }

        if (id == "englishSentence") {
          variableWord = patterns[patternIndex].englishA.match(/\[(\w+)\]/g)
          str = ""
          if (variableWord != null) {
            variableWord.forEach((item) => {
              item = item.replace("[", "").replace("]", "")
              variableWords = tupus.filter(v => (v.topic == item))
              //s = s.replace("[" + item + "]", variableWords[substitutedWordIndex].maori)
              list = tupus.filter(v => (v.topic == item))

              list.forEach(v => str = str + v.english + " " + v.maori + "\n")
            })
            alert(str)
          }
        }

        if (id == "maoriSentence") {
          alert(maoriSentenceText)
        }

        if (id.includes("tupu")) {
          maoriAnswerText = maoriAnswerText + " " + gridWords[id.match(/\d+/g)]
          maoriAnswerText = maoriAnswerText.replace(".", "")
          if (maoriAnswerText.trim() == substituteMaoriVariableWord(patterns[patternIndex].maoriQ) ||
            maoriAnswerText.trim() == substituteMaoriVariableWord(patterns[patternIndex].maoriA))
            sentenceCorrect = true
        }

        if (id == "deleteButton") {
          maoriAnswerText = maoriAnswerText.substring(0, maoriAnswerText.lastIndexOf(" "))
          sentenceCorrect = false
        }

        if (id == "redoButton") {
          maoriAnswerText = "."
          substitutedWordIndex++
          sentenceCorrect = false
        }
        display()
      }

      display()
    })
  </script>
</body>

</html>
